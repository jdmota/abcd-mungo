\lstset{language=,caption=\textit{AuctionProtocol.protocol}}
\begin{code}
typestate AuctionProtocol {
  Unknown = {
    Boolean canBid(int, double): <True: Bidding, False: Unknown>,
    int finish(): end
  }
  Bidding = {
    void bid(int, double): Unknown
  }
}\end{code}

\lstset{language=,caption=\textit{ClientProtocol.protocol}}
\begin{code}
typestate ClientProtocol {
  Running = {
    int getId(): Running,
    double getBid(): Running,
    void bid(double): Running,
    void close(): end
  }
}\end{code}

\lstset{language=Java,caption=\textit{Auction.java}}
\begin{code}
import mungo.lib.Typestate;

@Typestate("AuctionProtocol")
public class Auction {
  private int hBidder;
  private Client[] clients;
  private boolean ended;
  public Auction(int maxClients) {
    hBidder = -1;
    clients = new Client[maxClients];
    ended = false;
    for (int i = 0; i < maxClients; i++)
      clients[i] = new Client(i);
  }
  public Boolean canBid(int clientId, double val) {
    return 0 <= clientId && clientId < clients.length &&
           (hBidder == -1 ||
           (hBidder != clientId && val > clients[hBidder].getBid())) ?
              Boolean.True :
              Boolean.False;
  }
  public void bid(int clientId, double val) {
    clients[clientId].bid(val);
    hBidder = clientId;
  }
  // There is an error here, clients are not being closed!
  public int finish() {
    ended = true;
    for (Client client : clients) {
      System.out.println(client.getId());
      // client.close();
    }
    return hBidder;
  }
}\end{code}

\lstset{language=Java,caption=\textit{Boolean.java}}
\begin{code}
enum Boolean {
  True, False
}\end{code}

\lstset{language=Java,caption=\textit{Client.java}}
\begin{code}
import mungo.lib.Typestate;

@Typestate("ClientProtocol")
public class Client {
  private final int id;
	private double bid;
	public Client(int id) {
    this.id = id;
		this.bid = 0.0;
	}
  public int getId() {
    return id;
  }
  public double getBid() {
    return bid;
  }
	public void bid(double newBid) {
    bid = newBid;
  }
  public void close() {
    // Free resources...
  }
}\end{code}

\lstset{language=Java,caption=\textit{Main.java}}
\begin{code}
public class Main {
  public static void main(String[] args) {
    Auction auction = new Auction(2);
    switch(auction.canBid(0, 5.0)){
      case True:
        auction.bid(1, 5.0);
        break;
      case False:
        break;
    }
    auction.finish();
  }
}\end{code}

\lstset{language=,caption=Mungo's output}
\begin{code}

Auction.java: 29-17: Semantic Error
		Object reference is used uninitialised.

Auction.java: 29-17: Semantic Error
		Object reference is used uninitialised.

Auction.java: 29-17: Semantic Error
		Object reference is used uninitialised.\end{code}

\lstset{language=,caption=Our tool's output}
\begin{code}
error: SourceChecker.typeProcess: unexpected Throwable (NotImplementedError) while processing Auction.java; message: An operation is not implemented: #helpers.arrayInitWithDimensions not implemented
  ; The Checker Framework crashed.  Please report the crash.
  Compilation unit: Auction.java
  Last visited tree at line 3 column 1:
  @Typestate("AuctionProtocol")
  Exception: kotlin.NotImplementedError: An operation is not implemented: #helpers.arrayInitWithDimensions not implemented; kotlin.NotImplementedError: An operation is not implemented: #helpers.arrayInitWithDimensions not implemented
  	at jatyc.core.adapters.CFAdapter.helperToFuncInterface(CFAdapter.kt:634)
  	at jatyc.core.adapters.CFAdapter.transformHelper(CFAdapter.kt:645)
  	at jatyc.core.adapters.CFAdapter.access$transformHelper(CFAdapter.kt:201)
  	at jatyc.core.adapters.CFAdapter$connect$result$1.apply(CFAdapter.kt:547)
  	at jatyc.core.adapters.CFAdapter$connect$result$1.apply(CFAdapter.kt:201)
  	at java.util.Map.computeIfAbsent(Map.java:957)
  	at jatyc.core.adapters.CFAdapter.connect(CFAdapter.kt:547)
  	at jatyc.core.adapters.CFAdapter.connect(CFAdapter.kt:501)
  	at jatyc.core.adapters.CFAdapter.connect(CFAdapter.kt:492)
  	at jatyc.core.adapters.CFAdapter.connect(CFAdapter.kt:508)
  	at jatyc.core.adapters.CFAdapter.connect(CFAdapter.kt:492)
  	at jatyc.core.adapters.CFAdapter.connect(CFAdapter.kt:504)
  	at jatyc.core.adapters.CFAdapter.connect(CFAdapter.kt:492)
  	at jatyc.core.adapters.CFAdapter.connect(CFAdapter.kt:524)
  	at jatyc.core.adapters.CFAdapter.checkersCFGtoSimpleCFG(CFAdapter.kt:487)
  	at jatyc.core.adapters.CFAdapter.processCFG(CFAdapter.kt:479)
  	at jatyc.core.adapters.CFAdapter.transformClass(CFAdapter.kt:362)
  	at jatyc.core.adapters.CFAdapter.access$transformClass(CFAdapter.kt:201)
  	at jatyc.core.adapters.CFAdapter$transformClass$5.apply(CFAdapter.kt:440)
  	at jatyc.core.adapters.CFAdapter$transformClass$5.apply(CFAdapter.kt:201)
  	at java.util.Map.computeIfAbsent(Map.java:957)
  	at jatyc.core.adapters.CFAdapter.transformClass(CFAdapter.kt:437)
  	at jatyc.core.adapters.CFVisitor.visitClass(CFVisitor.kt:45)
  	at jatyc.core.adapters.CFVisitor.visitClass(CFVisitor.kt:28)
  	at com.sun.tools.javac.tree.JCTree$JCClassDecl.accept(JCTree.java:808)
  	at com.sun.source.util.TreePathScanner.scan(TreePathScanner.java:56)
  	at org.checkerframework.framework.source.SourceVisitor.visit(SourceVisitor.java:82)
  	at org.checkerframework.framework.source.SourceChecker.typeProcess(SourceChecker.java:954)
  	at org.checkerframework.javacutil.AbstractTypeProcessor$AttributionTaskListener.finished(AbstractTypeProcessor.java:190)
  	at com.sun.tools.javac.api.ClientCodeWrapper$WrappedTaskListener.finished(ClientCodeWrapper.java:828)
  	at com.sun.tools.javac.api.MultiTaskListener.finished(MultiTaskListener.java:120)
  	at com.sun.tools.javac.main.JavaCompiler.flow(JavaCompiler.java:1404)
  	at com.sun.tools.javac.main.JavaCompiler.flow(JavaCompiler.java:1363)
  	at com.sun.tools.javac.main.JavaCompiler.compile(JavaCompiler.java:959)
  	at com.sun.tools.javac.main.Main.compile(Main.java:302)
  	at com.sun.tools.javac.main.Main.compile(Main.java:162)
  	at com.sun.tools.javac.Main.compile(Main.java:57)
  	at com.sun.tools.javac.Main.main(Main.java:43)
1 error\end{code}

